{"remainingRequest":"C:\\work\\bi-admin-vue-new\\node_modules\\thread-loader\\dist\\cjs.js!C:\\work\\bi-admin-vue-new\\node_modules\\babel-loader\\lib\\index.js!C:\\work\\bi-admin-vue-new\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\work\\bi-admin-vue-new\\src\\table\\controller.js","dependencies":[{"path":"C:\\work\\bi-admin-vue-new\\src\\table\\controller.js","mtime":1552754725295},{"path":"C:\\work\\bi-admin-vue-new\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\work\\bi-admin-vue-new\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\work\\bi-admin-vue-new\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\work\\bi-admin-vue-new\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _regeneratorRuntime from \"C:\\\\work\\\\bi-admin-vue-new\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nimport debug from 'debug';\nimport _ from 'lodash';\nimport Vue from 'vue';\nimport LocalSettings from '../app/localSettings';\nimport StringUtil from './../util/string';\nimport events from './events';\nimport SortOrder from './sortOrder';\nvar log = debug('bi-admin-vue:table-controller');\n/**\r\n * @name SimpleTableController\r\n */\n\nvar _default =\n/*#__PURE__*/\nfunction (_Vue) {\n  _inherits(_default, _Vue);\n\n  function _default(configuration, resourceOrUrl, VueObject) {\n    var _this;\n\n    var additionalRequestParams = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n\n    _classCallCheck(this, _default);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(_default).call(this));\n    _this.filters = {};\n    _this.additionalRequestParams = additionalRequestParams;\n\n    if (!_.isObject(configuration)) {\n      throw new Error('Controller configuration is missing!');\n    }\n\n    _this.configuration = Object.assign({\n      identifier: StringUtil.randomString(10),\n      columns: [],\n      pagination: {\n        rowsPerPage: 20,\n        page: 1,\n        sortOrder: SortOrder.ASCENDING,\n        sortBy: 'id'\n      },\n      selectable: false,\n      multiSelect: false,\n      rowActions: [],\n      hiddenColumns: [],\n      filter: {}\n    }, configuration);\n\n    if (_.isString(resourceOrUrl)) {\n      _this.resource = VueObject.resource(resourceOrUrl, {});\n    } else {\n      _this.resource = resourceOrUrl;\n    }\n\n    var localSettings = LocalSettings.get(_this.configuration.identifier);\n    log(\"Got local settings for table \".concat(_this.configuration.identifier, \" \"), localSettings);\n\n    if (localSettings) {\n      if (localSettings.hiddenColumns) {\n        _this.configuration.hiddenColumns = localSettings.hiddenColumns;\n      }\n\n      if (localSettings.sortBy) {\n        _this.configuration.pagination.sortBy = localSettings.sortBy;\n      }\n\n      if (localSettings.sortOrder) {\n        _this.configuration.pagination.sortOrder = localSettings.sortOrder;\n      }\n\n      if (localSettings.rowsPerPage) {\n        _this.configuration.pagination.rowsPerPage = localSettings.rowsPerPage;\n      }\n\n      if (localSettings.page) {\n        _this.configuration.pagination.page = localSettings.page;\n      }\n    } else {\n      _this.updateLocalSettings();\n    }\n\n    return _this;\n  }\n\n  _createClass(_default, [{\n    key: \"setFilterValue\",\n    value: function setFilterValue(filtercode, filterValue) {\n      this.filters[filtercode] = filterValue;\n      this.$emit(events.FILTER_VALUE_CHANGED, {\n        code: filtercode,\n        value: filterValue\n      });\n    }\n  }, {\n    key: \"clearFilterValue\",\n    value: function clearFilterValue(filtercode) {\n      delete this.filters[filtercode];\n      this.$emit(events.FILTER_VALUE_CHANGED, {\n        code: filtercode\n      });\n    }\n  }, {\n    key: \"updateLocalSettings\",\n    value: function updateLocalSettings() {\n      LocalSettings.set(this.configuration.identifier, {\n        hiddenColumns: this.configuration.hiddenColumns,\n        pagination: this.configuration.pagination\n      });\n    }\n  }, {\n    key: \"toggleColumnVisible\",\n    value: function toggleColumnVisible(columnName) {\n      if (this.configuration.hiddenColumns.indexOf(columnName) > -1) {\n        this.configuration.hiddenColumns.splice(this.configuration.hiddenColumns.indexOf(columnName), 1);\n      } else {\n        this.configuration.hiddenColumns.push(columnName);\n      }\n\n      log('Hidden columns changed: ', this.configuration.hiddenColumns);\n      this.updateLocalSettings();\n      this.$emit(events.COLUMN_VISIBILITY_CHANGED, columnName);\n    }\n  }, {\n    key: \"switchSortOrder\",\n    value: function switchSortOrder() {\n      if (this.configuration.pagination.sortOrder === SortOrder.ASCENDING) {\n        this.configuration.pagination.sortOrder = SortOrder.DESCENDING;\n      } else {\n        this.configuration.pagination.sortOrder = SortOrder.ASCENDING;\n      }\n\n      this.updateLocalSettings();\n      this.$emit(events.SORT_CHANGED, {\n        sortBy: this.configuration.sortBy,\n        sortOrder: this.configuration.pagination.sortOrder\n      });\n      return this.loadData();\n    }\n  }, {\n    key: \"setSortBy\",\n    value: function setSortBy(sortBy) {\n      this.configuration.pagination.sortBy = sortBy;\n      this.updateLocalSettings();\n      this.$emit(events.SORT_CHANGED, {\n        sortBy: sortBy,\n        sortOrder: this.configuration.pagination.sortOrder\n      });\n      return this.loadData();\n    }\n  }, {\n    key: \"setPagination\",\n    value: function setPagination(pagination) {\n      this.configuration.pagination = pagination;\n      this.updateLocalSettings();\n      this.$emit(events.PAGINATION_CHANGED, this.configuration.pagination);\n      return this.loadData();\n    }\n  }, {\n    key: \"setRowsPerPage\",\n    value: function setRowsPerPage(rowsPerPage) {\n      this.configuration.pagination.rowsPerPage = rowsPerPage;\n      this.updateLocalSettings();\n      this.$emit(events.PAGINATION_CHANGED, {\n        rowsPerPage: rowsPerPage,\n        page: this.configuration.pagination.page\n      });\n      return this.loadData();\n    }\n  }, {\n    key: \"setPage\",\n    value: function setPage(page) {\n      this.configuration.pagination.page = page;\n      this.updateLocalSettings();\n      this.$emit(events.PAGINATION_CHANGED, {\n        page: page,\n        rowsPerPage: this.configuration.pagination.rowsPerPage\n      });\n      return this.loadData();\n    }\n  }, {\n    key: \"responseIsValid\",\n    value: function responseIsValid(response) {\n      return response.data && response.data.rows;\n    }\n  }, {\n    key: \"_getFilter\",\n    value: function _getFilter(filterConfiguration) {\n      var _this2 = this;\n\n      var filters = {};\n      Object.keys(filterConfiguration).map(function (filterKey) {\n        if (_this2.filters[filterKey] === undefined || _this2.filters[filterKey] === '') {\n          return;\n        } //let newFilter = Object.assign({value: this.filters[filterKey]}, filterConfiguration[filterKey]);\n\n\n        var newFilter = {\n          value: _this2.filters[filterKey],\n          fields: filterConfiguration[filterKey].fields\n        };\n        filters[filterKey] = newFilter;\n      });\n      return filters;\n    }\n    /**\r\n     * @throws Error;\r\n     * @returns {Promise<*>}\r\n     */\n\n  }, {\n    key: \"loadData\",\n    value: function () {\n      var _loadData = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var params, response;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this.$emit(events.DATA_LOADING, true);\n                log(\"Loading data from \".concat(this.resource.get.url));\n                params = Object.assign({}, this.configuration.pagination, {\n                  filter: this._getFilter(this.configuration.filter)\n                }, this.additionalRequestParams);\n\n                if (!params.sortBy) {\n                  params.sortBy = this.configuration.sortBy;\n                }\n\n                if (params.descending === true) {\n                  params.sortOrder = SortOrder.DESCENDING;\n                  delete params.descending;\n                } else if (params.descending === false) {\n                  params.sortOrder = SortOrder.ASCENDING;\n                  delete params.descending;\n                }\n\n                _context.prev = 5;\n                _context.next = 8;\n                return this.resource.get(params);\n\n              case 8:\n                response = _context.sent;\n\n                if (this.responseIsValid(response)) {\n                  _context.next = 12;\n                  break;\n                }\n\n                log(\"Data from \".concat(this.resource.get.url, \" are not valid\"));\n                throw new Error('Response is invalid');\n\n              case 12:\n                log(\"Data from \".concat(this.resource.get.url, \" loaded\"));\n                this.$emit(events.DATA_RECEIVED, response);\n                return _context.abrupt(\"return\", response);\n\n              case 17:\n                _context.prev = 17;\n                _context.t0 = _context[\"catch\"](5);\n                log(\"Unable to get data from URL \".concat(this.resource.get.url), _context.t0);\n                throw _context.t0;\n\n              case 21:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[5, 17]]);\n      }));\n\n      function loadData() {\n        return _loadData.apply(this, arguments);\n      }\n\n      return loadData;\n    }()\n  }]);\n\n  return _default;\n}(Vue);\n\nexport { _default as default };",{"version":3,"sources":["C:\\work\\bi-admin-vue-new\\src\\table\\controller.js"],"names":["debug","_","Vue","LocalSettings","StringUtil","events","SortOrder","log","configuration","resourceOrUrl","VueObject","additionalRequestParams","filters","isObject","Error","Object","assign","identifier","randomString","columns","pagination","rowsPerPage","page","sortOrder","ASCENDING","sortBy","selectable","multiSelect","rowActions","hiddenColumns","filter","isString","resource","localSettings","get","updateLocalSettings","filtercode","filterValue","$emit","FILTER_VALUE_CHANGED","code","value","set","columnName","indexOf","splice","push","COLUMN_VISIBILITY_CHANGED","DESCENDING","SORT_CHANGED","loadData","PAGINATION_CHANGED","response","data","rows","filterConfiguration","keys","map","filterKey","undefined","newFilter","fields","DATA_LOADING","url","params","_getFilter","descending","responseIsValid","DATA_RECEIVED"],"mappings":"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","sourcesContent":["import debug from 'debug';\r\nimport _ from 'lodash';\r\nimport Vue from 'vue';\r\nimport LocalSettings from '../app/localSettings';\r\nimport StringUtil from './../util/string';\r\nimport events from './events';\r\nimport SortOrder from './sortOrder';\r\n\r\nconst log = debug('bi-admin-vue:table-controller');\r\n\r\n/**\r\n * @name SimpleTableController\r\n */\r\nexport default class extends Vue {\r\n    constructor(configuration, resourceOrUrl, VueObject, additionalRequestParams = {}) {\r\n        super();\r\n        this.filters = {};\r\n        this.additionalRequestParams = additionalRequestParams;\r\n        if (!_.isObject(configuration)) {\r\n            throw new Error('Controller configuration is missing!');\r\n        }\r\n        this.configuration = Object.assign({\r\n            identifier   : StringUtil.randomString(10),\r\n            columns      : [],\r\n            pagination   : {\r\n                rowsPerPage: 20,\r\n                page       : 1,\r\n                sortOrder  : SortOrder.ASCENDING,\r\n                sortBy     : 'id',\r\n            },\r\n            selectable   : false,\r\n            multiSelect  : false,\r\n            rowActions   : [],\r\n            hiddenColumns: [],\r\n            filter       : {}\r\n        }, configuration);\r\n        if (_.isString(resourceOrUrl)) {\r\n            this.resource = VueObject.resource(resourceOrUrl, {});\r\n        } else {\r\n            this.resource = resourceOrUrl;\r\n        }\r\n        let localSettings = LocalSettings.get(this.configuration.identifier);\r\n        log(`Got local settings for table ${this.configuration.identifier} `, localSettings);\r\n        if (localSettings) {\r\n            if (localSettings.hiddenColumns) {\r\n                this.configuration.hiddenColumns = localSettings.hiddenColumns;\r\n            }\r\n            if (localSettings.sortBy) {\r\n                this.configuration.pagination.sortBy = localSettings.sortBy;\r\n            }\r\n            if (localSettings.sortOrder) {\r\n                this.configuration.pagination.sortOrder = localSettings.sortOrder;\r\n            }\r\n            if (localSettings.rowsPerPage) {\r\n                this.configuration.pagination.rowsPerPage = localSettings.rowsPerPage;\r\n            }\r\n            if (localSettings.page) {\r\n                this.configuration.pagination.page = localSettings.page;\r\n            }\r\n        } else {\r\n            this.updateLocalSettings();\r\n        }\r\n    }\r\n\r\n    setFilterValue(filtercode, filterValue) {\r\n        this.filters[filtercode] = filterValue;\r\n        this.$emit(events.FILTER_VALUE_CHANGED, {code: filtercode, value: filterValue});\r\n    }\r\n\r\n    clearFilterValue(filtercode) {\r\n        delete this.filters[filtercode];\r\n        this.$emit(events.FILTER_VALUE_CHANGED, {code: filtercode});\r\n    }\r\n\r\n    updateLocalSettings() {\r\n        LocalSettings.set(this.configuration.identifier, {\r\n            hiddenColumns: this.configuration.hiddenColumns,\r\n            pagination   : this.configuration.pagination,\r\n        });\r\n    }\r\n\r\n    toggleColumnVisible(columnName) {\r\n        if (this.configuration.hiddenColumns.indexOf(columnName) > -1) {\r\n            this.configuration.hiddenColumns.splice(this.configuration.hiddenColumns.indexOf(columnName), 1);\r\n        } else {\r\n            this.configuration.hiddenColumns.push(columnName);\r\n        }\r\n        log('Hidden columns changed: ', this.configuration.hiddenColumns);\r\n        this.updateLocalSettings();\r\n        this.$emit(events.COLUMN_VISIBILITY_CHANGED, columnName);\r\n    }\r\n\r\n    switchSortOrder() {\r\n        if (this.configuration.pagination.sortOrder === SortOrder.ASCENDING) {\r\n            this.configuration.pagination.sortOrder = SortOrder.DESCENDING;\r\n        } else {\r\n            this.configuration.pagination.sortOrder = SortOrder.ASCENDING;\r\n        }\r\n        this.updateLocalSettings();\r\n        this.$emit(events.SORT_CHANGED, {\r\n            sortBy   : this.configuration.sortBy,\r\n            sortOrder: this.configuration.pagination.sortOrder\r\n        });\r\n        return this.loadData();\r\n    }\r\n\r\n    setSortBy(sortBy) {\r\n        this.configuration.pagination.sortBy = sortBy;\r\n        this.updateLocalSettings();\r\n        this.$emit(events.SORT_CHANGED, {sortBy, sortOrder: this.configuration.pagination.sortOrder});\r\n        return this.loadData();\r\n    }\r\n\r\n    setPagination(pagination) {\r\n        this.configuration.pagination = pagination;\r\n        this.updateLocalSettings();\r\n        this.$emit(events.PAGINATION_CHANGED, this.configuration.pagination);\r\n        return this.loadData();\r\n    }\r\n\r\n    setRowsPerPage(rowsPerPage) {\r\n        this.configuration.pagination.rowsPerPage = rowsPerPage;\r\n        this.updateLocalSettings();\r\n        this.$emit(events.PAGINATION_CHANGED, {rowsPerPage, page: this.configuration.pagination.page});\r\n        return this.loadData();\r\n    }\r\n\r\n    setPage(page) {\r\n        this.configuration.pagination.page = page;\r\n        this.updateLocalSettings();\r\n        this.$emit(events.PAGINATION_CHANGED, {page, rowsPerPage: this.configuration.pagination.rowsPerPage});\r\n        return this.loadData();\r\n    }\r\n\r\n    responseIsValid(response) {\r\n        return response.data && response.data.rows;\r\n    }\r\n\r\n    _getFilter(filterConfiguration) {\r\n        let filters = {};\r\n        Object.keys(filterConfiguration).map((filterKey) => {\r\n            if (this.filters[filterKey] === undefined || this.filters[filterKey] === '') {\r\n                return;\r\n            }\r\n            //let newFilter = Object.assign({value: this.filters[filterKey]}, filterConfiguration[filterKey]);\r\n            let newFilter = {\r\n                value : this.filters[filterKey],\r\n                fields: filterConfiguration[filterKey].fields\r\n            }\r\n            filters[filterKey] = newFilter;\r\n        })\r\n        return filters;\r\n    }\r\n\r\n\r\n    /**\r\n     * @throws Error;\r\n     * @returns {Promise<*>}\r\n     */\r\n    async loadData() {\r\n        this.$emit(events.DATA_LOADING, true);\r\n        log(`Loading data from ${this.resource.get.url}`);\r\n\r\n        let params = Object.assign({}, this.configuration.pagination, {\r\n            filter: this._getFilter(this.configuration.filter)\r\n        }, this.additionalRequestParams);\r\n\r\n        if (!params.sortBy) {\r\n            params.sortBy = this.configuration.sortBy\r\n        }\r\n\r\n        if (params.descending === true) {\r\n            params.sortOrder = SortOrder.DESCENDING;\r\n            delete params.descending;\r\n        } else if (params.descending === false) {\r\n            params.sortOrder = SortOrder.ASCENDING;\r\n            delete params.descending;\r\n        }\r\n\r\n        try {\r\n            let response = await this.resource.get(params);\r\n            if (!this.responseIsValid(response)) {\r\n                log(`Data from ${this.resource.get.url} are not valid`);\r\n                throw new Error('Response is invalid');\r\n            }\r\n            log(`Data from ${this.resource.get.url} loaded`);\r\n            this.$emit(events.DATA_RECEIVED, response);\r\n            return response;\r\n        } catch (e) {\r\n            log(`Unable to get data from URL ${this.resource.get.url}`, e);\r\n            throw e;\r\n        }\r\n    }\r\n}"]}]}