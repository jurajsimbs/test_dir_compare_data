{"remainingRequest":"C:\\work\\bi-admin-vue-new\\node_modules\\babel-loader\\lib\\index.js!C:\\work\\bi-admin-vue-new\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\work\\bi-admin-vue-new\\src\\components\\editor\\widgets\\gallery\\galleryPlugin.js","dependencies":[{"path":"C:\\work\\bi-admin-vue-new\\src\\components\\editor\\widgets\\gallery\\galleryPlugin.js","mtime":1552754725237},{"path":"C:\\work\\bi-admin-vue-new\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\work\\bi-admin-vue-new\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\work\\bi-admin-vue-new\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"C:\\\\work\\\\bi-admin-vue-new\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"C:\\\\work\\\\bi-admin-vue-new\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"C:\\\\work\\\\bi-admin-vue-new\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _createClass from \"C:\\\\work\\\\bi-admin-vue-new\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/createClass\";\nimport _inherits from \"C:\\\\work\\\\bi-admin-vue-new\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/inherits\";\nimport _getPrototypeOf from \"C:\\\\work\\\\bi-admin-vue-new\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _get from \"C:\\\\work\\\\bi-admin-vue-new\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/get\";\nimport BasePlugin from './../basePlugin';\nvar instance;\n\nvar GalleryPlugin =\n/*#__PURE__*/\nfunction (_BasePlugin) {\n  _inherits(GalleryPlugin, _BasePlugin);\n\n  _createClass(GalleryPlugin, [{\n    key: \"registerButton\",\n    value: function registerButton(editor) {\n      _get(_getPrototypeOf(GalleryPlugin.prototype), \"registerButton\", this).call(this, editor);\n\n      editor.ui.addButton('gallery', {\n        label: 'Add Gallery',\n        command: 'gallery',\n        icon: 'gallery'\n      });\n    }\n  }, {\n    key: \"registerWidget\",\n    value: function registerWidget(editor) {\n      var self = this;\n      editor.widgets.add(this.ckOptions.element, {\n        allowedContent: true,\n        upcast: function upcast(element) {\n          return element.className === 'gallery';\n        },\n        dialog: this.code\n      });\n    }\n  }, {\n    key: \"registerContextMenu\",\n    value: function registerContextMenu(editor) {\n      var self = this;\n      editor.addMenuGroup('gallery', 1);\n      editor.addMenuItems({\n        gallery_deleteGallery: {\n          label: 'Delete gallery',\n          group: 'gallery',\n          command: self.code + 'delete',\n          order: 1\n        },\n        gallery_props: {\n          label: 'Gallery properties',\n          group: 'gallery',\n          command: self.code + 'props',\n          order: 2\n        }\n      });\n      editor.contextMenu.addListener(function (element, selection, path) {\n        if (element.$.classList && element.$.classList.contains('gallery') || element.$.closest('.gallery')) {\n          return {\n            gallery: CKEDITOR.TRISTATE_OFF,\n            gallery_deleteGallery: CKEDITOR.TRISTATE_OFF,\n            gallery_props: CKEDITOR.TRISTATE_OFF\n          };\n        }\n\n        return null;\n      });\n    }\n  }, {\n    key: \"registerCommand\",\n    value: function registerCommand(editor) {\n      var self = this;\n\n      self.editMethod =\n      /*#__PURE__*/\n      function () {\n        var _ref = _asyncToGenerator(\n        /*#__PURE__*/\n        regeneratorRuntime.mark(function _callee(editor, self) {\n          var selection, element, currentItem, currentData, images, newProps, gallery, i, slide, picture;\n          return regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  selection = editor.getSelection();\n                  element = selection.getStartElement();\n                  currentItem = element.$.closest('.gallery');\n                  currentData = {};\n                  currentItem.childNodes.forEach(function (element) {\n                    if (element.localName == 'app-gallery') {\n                      currentData = element;\n                    }\n                  });\n                  images = [];\n\n                  if (currentData.childNodes.length > 0) {\n                    currentData.childNodes.forEach(function (slide) {\n                      if (slide.localName == 'app-gallery-slide') {\n                        slide.childNodes.forEach(function (picture) {\n                          if (picture.localName == 'app-picture') {\n                            var i;\n\n                            (function () {\n                              var image = {};\n\n                              for (i = 0; i < picture.attributes.length; i++) {\n                                var name = picture.attributes.item(i).name;\n                                var value = picture.attributes.item(i).value;\n\n                                if (name == 'thumb-sizes') {\n                                  image.thumbSizes = [];\n                                  value.split(',').forEach(function (element) {\n                                    image.thumbSizes.push(Number(element));\n                                  });\n                                } else if (name == 'thumb-formats') {\n                                  image.thumbFormats = value.split(',');\n                                } else if (name != 'vce-ready') {\n                                  image[name] = value;\n                                }\n                              }\n\n                              images.push(image);\n                            })();\n                          }\n                        });\n                      }\n                    });\n                  }\n\n                  _context.next = 9;\n                  return self.onShowDialogRequested({\n                    title: currentData.title,\n                    description: currentData.description,\n                    padding: currentData.padding,\n                    carousel: currentData.carousel,\n                    images: images,\n                    type: 'gallery'\n                  });\n\n                case 9:\n                  newProps = _context.sent;\n\n                  if (newProps) {\n                    _context.next = 12;\n                    break;\n                  }\n\n                  return _context.abrupt(\"return\");\n\n                case 12:\n                  while (element.$.firstChild) {\n                    element.$.removeChild(element.$.firstChild);\n                  }\n\n                  gallery = editor.document.createElement('app-gallery');\n                  gallery.setAttribute('title', newProps.title ? newProps.title : '');\n                  gallery.setAttribute('description', newProps.description ? newProps.description : '');\n                  gallery.setAttribute('padding', newProps.padding ? newProps.padding : '');\n                  gallery.setAttribute('carousel', newProps.carousel);\n\n                  for (i = 0; i < newProps.images.length; i++) {\n                    slide = editor.document.createElement('app-gallery-slide');\n                    picture = editor.document.createElement('app-picture');\n                    picture.setAttribute('code', newProps.images[i].code);\n                    picture.setAttribute('thumb-sizes', newProps.images[i].thumbSizes);\n                    picture.setAttribute('thumb-formats', newProps.images[i].thumbFormats);\n                    picture.setAttribute('title', newProps.images[i].title);\n                    picture.setAttribute('description', newProps.images[i].description);\n                    picture.setAttribute('alt', newProps.images[i].alt);\n                    picture.setAttribute('lightbox', newProps.images[i].lightbox);\n                    slide.append(picture);\n                    gallery.append(slide);\n                  }\n\n                  currentItem.appendChild(gallery.$);\n                  editor.fire('change');\n\n                case 21:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function (_x, _x2) {\n          return _ref.apply(this, arguments);\n        };\n      }();\n\n      editor.addCommand(this.code + 'props', {\n        exec: function exec() {\n          self.editMethod(editor, self);\n        }\n      });\n      editor.addCommand(this.code + 'delete', {\n        exec: function () {\n          var _exec = _asyncToGenerator(\n          /*#__PURE__*/\n          regeneratorRuntime.mark(function _callee2() {\n            var selection, element, gallery, confirmation;\n            return regeneratorRuntime.wrap(function _callee2$(_context2) {\n              while (1) {\n                switch (_context2.prev = _context2.next) {\n                  case 0:\n                    selection = editor.getSelection();\n                    element = selection.getStartElement();\n                    gallery = element.$.closest('.gallery');\n                    _context2.next = 5;\n                    return self.confirm('Gallery will be lost! Delete?');\n\n                  case 5:\n                    confirmation = _context2.sent;\n\n                    if (confirmation) {\n                      while (gallery.firstChild) {\n                        gallery.removeChild(gallery.firstChild);\n                      }\n\n                      gallery.parentElement.removeChild(gallery);\n                    }\n\n                    editor.fire('change');\n\n                  case 8:\n                  case \"end\":\n                    return _context2.stop();\n                }\n              }\n            }, _callee2);\n          }));\n\n          function exec() {\n            return _exec.apply(this, arguments);\n          }\n\n          return exec;\n        }()\n      });\n      editor.addCommand(this.code, {\n        exec: function () {\n          var _exec2 = _asyncToGenerator(\n          /*#__PURE__*/\n          regeneratorRuntime.mark(function _callee3() {\n            var selection, element, newProps, gallery, date, id, i, slide, picture, newElement;\n            return regeneratorRuntime.wrap(function _callee3$(_context3) {\n              while (1) {\n                switch (_context3.prev = _context3.next) {\n                  case 0:\n                    selection = editor.getSelection();\n                    element = selection.getStartElement();\n\n                    if (element) {\n                      element = element.getAscendant(self.ckOptions.element, true);\n                    }\n\n                    if (!(!element || element.getName() !== self.ckOptions.element || element)) {\n                      _context3.next = 26;\n                      break;\n                    }\n\n                    element = editor.document.createElement('div');\n                    element.$.classList.add('gallery');\n                    _context3.next = 8;\n                    return self.onShowDialogRequested({\n                      type: 'gallery'\n                    });\n\n                  case 8:\n                    newProps = _context3.sent;\n\n                    if (newProps) {\n                      _context3.next = 11;\n                      break;\n                    }\n\n                    return _context3.abrupt(\"return\");\n\n                  case 11:\n                    gallery = editor.document.createElement('app-gallery');\n                    gallery.setAttribute('title', newProps.title ? newProps.title : '');\n                    gallery.setAttribute('description', newProps.description ? newProps.description : '');\n                    gallery.setAttribute('padding', newProps.padding ? newProps.padding : '');\n                    gallery.setAttribute('carousel', newProps.carousel);\n                    date = new Date();\n                    id = 'created_at_' + date.getTime();\n                    gallery.setAttribute('id', id);\n\n                    for (i = 0; i < newProps.images.length; i++) {\n                      slide = editor.document.createElement('app-gallery-slide');\n                      picture = editor.document.createElement('app-picture');\n                      picture.setAttribute('code', newProps.images[i].code);\n                      picture.setAttribute('thumb-sizes', newProps.images[i].thumbSizes);\n                      picture.setAttribute('thumb-formats', newProps.images[i].thumbFormats);\n                      picture.setAttribute('title', newProps.images[i].title);\n                      picture.setAttribute('description', newProps.images[i].description);\n                      picture.setAttribute('alt', newProps.images[i].alt);\n                      picture.setAttribute('lightbox', newProps.images[i].lightbox);\n                      slide.append(picture);\n                      gallery.append(slide);\n                    }\n\n                    element.$.innerHTML = null;\n                    element.$.appendChild(gallery.$);\n                    editor.insertHtml(element.$.outerHTML);\n                    editor.widgets.initOn(element, self.code);\n                    newElement = document.getElementById(id);\n                    newElement.addEventListener('dblclick', function (event) {\n                      self.editMethod(editor, self);\n                    });\n\n                  case 26:\n                  case \"end\":\n                    return _context3.stop();\n                }\n              }\n            }, _callee3);\n          }));\n\n          function exec() {\n            return _exec2.apply(this, arguments);\n          }\n\n          return exec;\n        }()\n      });\n    }\n  }], [{\n    key: \"createAndRegister\",\n    value: function createAndRegister(CKEDITOR) {\n      if (!instance) {\n        instance = new GalleryPlugin('gallery', 'Gallery', 'Edit Gallery', {\n          element: \"div\"\n        });\n      }\n\n      if (!CKEDITOR.plugins.registered[instance.code]) {\n        CKEDITOR.plugins.add(instance.code, {\n          init: function init(editor) {\n            instance.init(editor);\n          },\n          requires: 'contextmenu'\n        });\n      }\n\n      return instance;\n    }\n  }]);\n\n  function GalleryPlugin(code, buttonLabel, contextMenuEditLabel, ckOptions) {\n    _classCallCheck(this, GalleryPlugin);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(GalleryPlugin).call(this, code, buttonLabel, contextMenuEditLabel, ckOptions));\n  }\n\n  return GalleryPlugin;\n}(BasePlugin);\n\nexport default GalleryPlugin;",{"version":3,"sources":["C:\\work\\bi-admin-vue-new\\src\\components\\editor\\widgets\\gallery\\galleryPlugin.js"],"names":["BasePlugin","instance","GalleryPlugin","editor","ui","addButton","label","command","icon","self","widgets","add","ckOptions","element","allowedContent","upcast","className","dialog","code","addMenuGroup","addMenuItems","gallery_deleteGallery","group","order","gallery_props","contextMenu","addListener","selection","path","$","classList","contains","closest","gallery","CKEDITOR","TRISTATE_OFF","editMethod","getSelection","getStartElement","currentItem","currentData","childNodes","forEach","localName","images","length","slide","picture","i","image","attributes","name","item","value","thumbSizes","split","push","Number","thumbFormats","onShowDialogRequested","title","description","padding","carousel","type","newProps","firstChild","removeChild","document","createElement","setAttribute","alt","lightbox","append","appendChild","fire","addCommand","exec","confirm","confirmation","parentElement","getAscendant","getName","date","Date","id","getTime","innerHTML","insertHtml","outerHTML","initOn","newElement","getElementById","addEventListener","event","plugins","registered","init","requires","buttonLabel","contextMenuEditLabel"],"mappings":"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","sourcesContent":["import BasePlugin from './../basePlugin';\r\n\r\nlet instance;\r\n\r\nclass GalleryPlugin extends BasePlugin {\r\n    static createAndRegister(CKEDITOR) {\r\n        if (!instance) {\r\n            instance = new GalleryPlugin('gallery', 'Gallery', 'Edit Gallery', {\r\n                element: \"div\"\r\n            });\r\n        }\r\n        if (!CKEDITOR.plugins.registered[instance.code]) {\r\n            CKEDITOR.plugins.add(instance.code, {\r\n                init     : function (editor) {\r\n                    instance.init(editor);\r\n                },\r\n                requires : 'contextmenu'\r\n            });\r\n        }\r\n        return instance;\r\n    }\r\n\r\n    registerButton(editor) {\r\n        super.registerButton(editor);\r\n        editor.ui.addButton('gallery', {\r\n            label  : 'Add Gallery',\r\n            command: 'gallery',\r\n            icon   : 'gallery'\r\n        });\r\n    }\r\n\r\n    registerWidget(editor) {\r\n        let self = this;\r\n        editor.widgets.add(this.ckOptions.element, {\r\n            allowedContent: true,\r\n            upcast        : function (element) {\r\n                return element.className === 'gallery';\r\n            },\r\n            dialog: this.code\r\n        });\r\n    }\r\n\r\n    registerContextMenu(editor) {\r\n        let self = this;\r\n        editor.addMenuGroup('gallery', 1);\r\n        editor.addMenuItems({\r\n            gallery_deleteGallery  : {\r\n                label  : 'Delete gallery',\r\n                group  : 'gallery',\r\n                command: self.code + 'delete',\r\n                order  : 1\r\n            },\r\n            gallery_props       : {\r\n                label  : 'Gallery properties',\r\n                group  : 'gallery',\r\n                command: self.code + 'props',\r\n                order  : 2\r\n            }\r\n        });\r\n        editor.contextMenu.addListener(function (element, selection, path) {\r\n            if (element.$.classList && element.$.classList.contains('gallery') || element.$.closest('.gallery')) {\r\n                return {\r\n                    gallery                 : CKEDITOR.TRISTATE_OFF,\r\n                    gallery_deleteGallery   : CKEDITOR.TRISTATE_OFF,\r\n                    gallery_props           : CKEDITOR.TRISTATE_OFF\r\n                };\r\n            }\r\n            return null;\r\n        });\r\n    }\r\n\r\n    registerCommand(editor) {\r\n        let self = this;\r\n\r\n        self.editMethod = async function (editor, self) {\r\n            let selection = editor.getSelection();\r\n            let element = selection.getStartElement();\r\n\r\n            let currentItem = element.$.closest('.gallery');\r\n            let currentData = {};\r\n            currentItem.childNodes.forEach(element => {\r\n                if (element.localName == 'app-gallery') {\r\n                    currentData = element;\r\n                }\r\n            });\r\n\r\n            let images = [];\r\n            if (currentData.childNodes.length > 0) {\r\n                currentData.childNodes.forEach(slide => {\r\n                    if (slide.localName == 'app-gallery-slide') {\r\n                        slide.childNodes.forEach(picture => {\r\n                            if (picture.localName == 'app-picture') {\r\n                                let image = {};\r\n                                for (var i = 0; i < picture.attributes.length; i++) {\r\n                                    let name = picture.attributes.item(i).name;\r\n                                    let value = picture.attributes.item(i).value;\r\n\r\n                                    if (name == 'thumb-sizes') {\r\n                                        image.thumbSizes = [];\r\n                                        value.split(',').forEach(element => {\r\n                                            image.thumbSizes.push(Number(element));\r\n                                        });\r\n                                    }\r\n                                    else if (name == 'thumb-formats') {\r\n                                        image.thumbFormats = value.split(',');\r\n                                    } else if (name != 'vce-ready') {\r\n                                        image[name] = value;\r\n                                    }\r\n                                }\r\n                                images.push(image);\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n\r\n            let newProps = await self.onShowDialogRequested({ \r\n                    title: currentData.title,\r\n                    description: currentData.description,\r\n                    padding: currentData.padding,\r\n                    carousel: currentData.carousel,\r\n                    images: images,\r\n                    type: 'gallery'\r\n                }\r\n            );\r\n            if (!newProps) {\r\n                return;\r\n            }\r\n\r\n            while (element.$.firstChild) {\r\n                element.$.removeChild(element.$.firstChild);\r\n            }\r\n\r\n            let gallery = editor.document.createElement('app-gallery');\r\n            gallery.setAttribute('title', newProps.title ? newProps.title : '');\r\n            gallery.setAttribute('description', newProps.description ? newProps.description : '');\r\n            gallery.setAttribute('padding', newProps.padding ? newProps.padding : '');\r\n            gallery.setAttribute('carousel', newProps.carousel);\r\n\r\n            for (let i = 0; i < newProps.images.length; i++) {\r\n                let slide = editor.document.createElement('app-gallery-slide');\r\n\r\n                let picture = editor.document.createElement('app-picture');\r\n                picture.setAttribute('code', newProps.images[i].code);\r\n                picture.setAttribute('thumb-sizes', newProps.images[i].thumbSizes);\r\n                picture.setAttribute('thumb-formats', newProps.images[i].thumbFormats);\r\n                picture.setAttribute('title', newProps.images[i].title);\r\n                picture.setAttribute('description', newProps.images[i].description);\r\n                picture.setAttribute('alt', newProps.images[i].alt);\r\n                picture.setAttribute('lightbox', newProps.images[i].lightbox);\r\n                \r\n                slide.append(picture);\r\n                gallery.append(slide);\r\n            }\r\n\r\n            currentItem.appendChild(gallery.$);\r\n            editor.fire('change');\r\n        };\r\n\r\n        editor.addCommand(this.code + 'props', {\r\n            exec: () => { self.editMethod(editor, self); }\r\n        });\r\n        editor.addCommand(this.code + 'delete', {\r\n            exec: async function () {\r\n                let selection = editor.getSelection();\r\n                let element = selection.getStartElement();\r\n                let gallery = element.$.closest('.gallery');\r\n                let confirmation = await self.confirm('Gallery will be lost! Delete?');\r\n                if (confirmation) {\r\n                    while (gallery.firstChild) {\r\n                        gallery.removeChild(gallery.firstChild);\r\n                    }\r\n                    gallery.parentElement.removeChild(gallery);\r\n                }\r\n                editor.fire('change');\r\n            }\r\n        });\r\n        editor.addCommand(this.code, {\r\n            exec: async function () {\r\n                let selection = editor.getSelection();\r\n                let element = selection.getStartElement();\r\n\r\n                if (element) {\r\n                    element = element.getAscendant(self.ckOptions.element, true);\r\n                }\r\n\r\n                if (!element || element.getName() !== self.ckOptions.element || element) {\r\n                    element = editor.document.createElement('div');\r\n                    element.$.classList.add('gallery');\r\n\r\n                    let newProps = await self.onShowDialogRequested({ type: 'gallery' });\r\n                    if (!newProps) {\r\n                        return;\r\n                    }\r\n\r\n                    let gallery = editor.document.createElement('app-gallery');\r\n                    gallery.setAttribute('title', newProps.title ? newProps.title : '');\r\n                    gallery.setAttribute('description', newProps.description ? newProps.description : '');\r\n                    gallery.setAttribute('padding', newProps.padding ? newProps.padding : '');\r\n                    gallery.setAttribute('carousel', newProps.carousel);\r\n\r\n                    let date = new Date();\r\n                    let id = 'created_at_' + date.getTime();\r\n                    gallery.setAttribute('id', id);\r\n\r\n                    for (let i = 0; i < newProps.images.length; i++) {\r\n                        let slide = editor.document.createElement('app-gallery-slide');\r\n\r\n                        let picture = editor.document.createElement('app-picture');\r\n                        picture.setAttribute('code', newProps.images[i].code);\r\n                        picture.setAttribute('thumb-sizes', newProps.images[i].thumbSizes);\r\n                        picture.setAttribute('thumb-formats', newProps.images[i].thumbFormats);\r\n                        picture.setAttribute('title', newProps.images[i].title);\r\n                        picture.setAttribute('description', newProps.images[i].description);\r\n                        picture.setAttribute('alt', newProps.images[i].alt);\r\n                        picture.setAttribute('lightbox', newProps.images[i].lightbox);\r\n\r\n                        slide.append(picture);\r\n                        gallery.append(slide);\r\n                    }\r\n\r\n                    element.$.innerHTML = null;\r\n                    element.$.appendChild(gallery.$);\r\n                    editor.insertHtml(element.$.outerHTML);\r\n                    editor.widgets.initOn(element, self.code);\r\n\r\n                    let newElement = document.getElementById(id);\r\n                    newElement.addEventListener('dblclick', function(event) { self.editMethod(editor, self); });\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    constructor(code, buttonLabel, contextMenuEditLabel, ckOptions) {\r\n        super(code, buttonLabel, contextMenuEditLabel, ckOptions);\r\n    }\r\n}\r\n\r\nexport default GalleryPlugin;"]}]}