{"remainingRequest":"C:\\work\\bi-admin-vue-new\\node_modules\\babel-loader\\lib\\index.js!C:\\work\\bi-admin-vue-new\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\work\\bi-admin-vue-new\\src\\permission\\handler.js","dependencies":[{"path":"C:\\work\\bi-admin-vue-new\\src\\permission\\handler.js","mtime":1552754725288},{"path":"C:\\work\\bi-admin-vue-new\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\work\\bi-admin-vue-new\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\work\\bi-admin-vue-new\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["'use strict';\n\nimport \"core-js/modules/es6.function.name\";\nimport _classCallCheck from \"C:\\\\work\\\\bi-admin-vue-new\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\work\\\\bi-admin-vue-new\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/createClass\";\nimport debug from 'debug';\nvar log = debug('permission-hanlder');\n/**\r\n * @class Permissions\r\n */\n\nvar Permissions =\n/*#__PURE__*/\nfunction () {\n  function Permissions() {\n    _classCallCheck(this, Permissions);\n  }\n\n  _createClass(Permissions, null, [{\n    key: \"get\",\n\n    /**\r\n     * @static\r\n     * @memberOf Permissions\r\n     * @param model\r\n     * @param permissionName\r\n     * @returns {undefined}\r\n     */\n    value: function get(model, permissionName) {\n      if (!this.has(model, permissionName)) {\n        return undefined;\n      }\n\n      return this._getPermissionValue(model, permissionName);\n    }\n    /**\r\n     * @static\r\n     * @memberOf PermissionsXXXXX\r\n     * @param model\r\n     * @param permissionName\r\n     * @private\r\n     */\n\n  }, {\n    key: \"_getPermissionValue\",\n    value: function _getPermissionValue(model, permissionName) {\n      if (!model.UserPermissions) {\n        return;\n      }\n\n      for (var i = 0; i < model.UserPermissions.length; i++) {\n        var userPermission = model.UserPermissions[i];\n        log('_getPermissionValue', userPermission, permissionName);\n\n        if (userPermission.permission === permissionName) {\n          log('got it!');\n          return userPermission.value;\n        }\n\n        if (permissionName.indexOf('.') > -1 && permissionName.substr(0, permissionName.indexOf('.')) + '.*' === userPermission.permission) {\n          return userPermission.value;\n        }\n      }\n\n      return;\n    }\n  }, {\n    key: \"check\",\n    value: function check(user, permission) {\n      log('Chek user', user, 'permission', permission); //TODO: finish me\n\n      if (permission.or) {\n        for (var i = 0; i < permission.or.length; i++) {\n          log('p', permission.or[i]);\n\n          if (this.has(user, {\n            name: permission.or[i],\n            value: null\n          })) {\n            log(\"user has \".concat(permission.or[i]));\n            return true;\n          } else {\n            log(\"user doesnt have \".concat(permission.or[i]));\n          }\n        }\n\n        return false;\n      }\n\n      if (permission.and) {\n        for (var _i = 0; _i < permission.and.length; _i++) {\n          log(\"user has \".concat(permission.or[_i]));\n\n          if (this.has(user, {\n            name: permission.and[_i],\n            value: null\n          })) {\n            return true;\n          } else {\n            log(\"user doesnt have \".concat(permission.or[_i]));\n          }\n        }\n\n        return false;\n      }\n\n      return false;\n    }\n    /**\r\n     * @static\r\n     * @memberOf Permissions\r\n     * @param model\r\n     * @param permissionName\r\n     * @returns {boolean}\r\n     */\n\n  }, {\n    key: \"has\",\n    value: function has(model, permission) {\n      if (!model || !model.UserPermissions) {\n        return false;\n      }\n\n      var value = this._getPermissionValue(model, permission.name); //TODO: check by type\n\n\n      log('got val', value);\n\n      if (value !== undefined) {\n        if (permission.value === undefined) {\n          return true;\n        }\n\n        return permission.value === value;\n      }\n\n      log('nope');\n      return false;\n    }\n  }]);\n\n  return Permissions;\n}();\n\nexport { Permissions as default };\n;",{"version":3,"sources":["C:\\work\\bi-admin-vue-new\\src\\permission\\handler.js"],"names":["debug","log","Permissions","model","permissionName","has","undefined","_getPermissionValue","UserPermissions","i","length","userPermission","permission","value","indexOf","substr","user","or","name","and"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nimport debug from 'debug';\r\n\r\nconst log = debug('permission-hanlder');\r\n\r\n/**\r\n * @class Permissions\r\n */\r\nexport default class Permissions {\r\n\r\n    /**\r\n     * @static\r\n     * @memberOf Permissions\r\n     * @param model\r\n     * @param permissionName\r\n     * @returns {undefined}\r\n     */\r\n    static get(model, permissionName) {\r\n        if (!this.has(model, permissionName)) {\r\n            return undefined;\r\n        }\r\n        return this._getPermissionValue(model, permissionName);\r\n    }\r\n\r\n    /**\r\n     * @static\r\n     * @memberOf PermissionsXXXXX\r\n     * @param model\r\n     * @param permissionName\r\n     * @private\r\n     */\r\n    static _getPermissionValue(model, permissionName) {\r\n        if (!model.UserPermissions) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < model.UserPermissions.length; i++) {\r\n            let userPermission = model.UserPermissions[i];\r\n            log('_getPermissionValue', userPermission, permissionName);\r\n            if (userPermission.permission === permissionName) {\r\n                log('got it!');\r\n                return userPermission.value;\r\n            }\r\n            if (permissionName.indexOf('.') > -1 && permissionName.substr(0, permissionName.indexOf('.')) + '.*' === userPermission.permission) {\r\n                return userPermission.value;\r\n            }\r\n        }\r\n        return;\r\n    }\r\n\r\n    static check(user, permission) {\r\n        log('Chek user', user, 'permission', permission);\r\n        //TODO: finish me\r\n        if (permission.or) {\r\n            for (let i = 0; i < permission.or.length; i++) {\r\n                log('p', permission.or[i]);\r\n                if (this.has(user, {name: permission.or[i], value: null})) {\r\n                    log(`user has ${permission.or[i]}`)\r\n                    return true;\r\n                } else {\r\n                    log(`user doesnt have ${permission.or[i]}`)\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n        if (permission.and) {\r\n            for (let i = 0; i < permission.and.length; i++) {\r\n                log(`user has ${permission.or[i]}`)\r\n                if (this.has(user, {name: permission.and[i], value: null})) {\r\n                    return true;\r\n                } else {\r\n                    log(`user doesnt have ${permission.or[i]}`)\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @static\r\n     * @memberOf Permissions\r\n     * @param model\r\n     * @param permissionName\r\n     * @returns {boolean}\r\n     */\r\n    static has(model, permission) {\r\n\r\n        if (!model || !model.UserPermissions) {\r\n            return false;\r\n        }\r\n\r\n        let value = this._getPermissionValue(model, permission.name); //TODO: check by type\r\n\r\n        log('got val', value);\r\n        if (value !== undefined) {\r\n            if (permission.value === undefined) {\r\n                return true;\r\n            }\r\n            return permission.value === value;\r\n        }\r\n        log('nope');\r\n        return false;\r\n    }\r\n};"]}]}